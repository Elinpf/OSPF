load "core.rb"

socket = Socket.create_eth0

hello = Factory.create_ospf_hello_packet

hello.eth_src = Socket.getmyhostmac
hello.eth_daddr = "cc:01:32:34:00:00"
hello.ip_saddr = "0.5.2.0"
hello.ip_daddr = "1.3.1.4"
#hello.ip_proto = 89
hello.ip_tos = 192
# TTL value to 1 for Local Network
hello.ip_ttl = 32

hello.ospf_rid_quad = "192.168.18.136"
hello.ospf_netmask_quad = "255.255.255.0"
hello.ospf_dr_quad = "192.168.18.136"

hello.ospf_opt_set "e", "l"

# payload
pay = ""
pay << "\x00" * 14
pay << ("\x00" * 16) * 19

########  1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16
pay << "\x00\x00\x00\x2a\x2a\x00\x00\x00\x00\x00\x00\x2a\x2a\x00\x00\x00" # 1
pay << "\x00\x00\x2a\x00\x00\x2a\x00\x00\x00\x00\x2a\x00\x00\x2a\x00\x00" # 2
pay << "\x00\x2a\x00\x00\x00\x00\x2a\x00\x00\x2a\x00\x00\x00\x00\x2a\x00" # 3
pay << "\x2a\x00\x00\x00\x00\x00\x00\x2a\x2a\x00\x00\x00\x00\x00\x00\x2a" # 4
pay << "\x2a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a" # 5
pay << "\x2a\x00\x00\x50\x46\x00\x00\x00\x00\x00\x59\x5a\x4c\x00\x00\x2a" # 6
pay << "\x2a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a" # 7
pay << "\x00\x2a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x00" # 8
pay << "\x00\x00\x2a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x00\x00" # 9
pay << "\x00\x00\x00\x2a\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x00\x00\x00" # 10
pay << "\x00\x00\x00\x00\x2a\x00\x00\x00\x00\x00\x00\x2a\x00\x00\x00\x00" # 11
pay << "\x00\x00\x00\x00\x00\x2a\x00\x00\x00\x00\x2a\x00\x00\x00\x00\x00" # 12
pay << "\x00\x00\x00\x00\x00\x00\x2a\x00\x00\x2a\x00\x00\x00\x00\x00\x00" # 13
pay << "\x00\x00\x00\x00\x00\x00\x00\x2a\x2a\x00\x00\x00\x00\x00\x00\x00" # 14

pay << "\x00" * 16

hello.payload = pay

# calc
hello.ospf_len = 44
hello.ospf_recalc(:ospf_cksum)
hello.ip_recalc

# send
socket.send(hello.to_s, 0); socket.close
p hello
